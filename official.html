<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROG-RAKSHAK (Official Portal)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet Map Library -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f7f4; }
        .nav-link.active { background-color: #e0e7ff; color: #4338ca; font-weight: 600; border-left: 4px solid #4f46e5; padding-left: 12px;}
        .nav-link.active i { color: #4f46e5; }
        .nav-link { border-left: 4px solid transparent; padding-left: 12px;}
        .toast {
            visibility: hidden; min-width: 250px; margin-left: -125px; background-color: #333; color: #fff; text-align: center;
            border-radius: 8px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; opacity: 0;
            transition: visibility 0s, opacity 0.5s linear;
        }
        .toast.show { visibility: visible; opacity: 1; }
        #map { height: 600px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="text-gray-800">
    <div id="firebase-config-warning" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4" role="alert">
      <p class="font-bold">Configuration Needed</p>
      <p>Firebase is not configured. Real-time updates across devices will not work. Please ask for the next step to set up your database.</p>
    </div>

    <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white shadow-lg flex-col hidden md:flex">
            <div class="p-5 border-b flex items-center space-x-3">
                <div class="bg-teal-500 p-2 rounded-full">
                     <i class="fas fa-heart-pulse text-white"></i>
                </div>
                <h1 class="text-xl font-bold text-gray-700">ROG-RAKSHAK</h1>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" class="nav-link flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-100 active" data-tab="dashboard">
                    <i class="fas fa-chart-pie w-6 text-center text-gray-400"></i><span class="ml-3">Dashboard</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-100" data-tab="map">
                    <i class="fas fa-map-marked-alt w-6 text-center text-gray-400"></i><span class="ml-3">Map View</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-100" data-tab="report">
                    <i class="fas fa-file-medical w-6 text-center text-gray-400"></i><span class="ml-3">Report Data</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-100" data-tab="publish">
                    <i class="fas fa-bullhorn w-6 text-center text-gray-400"></i><span class="ml-3">Publish Alert</span>
                </a>
                 <a href="#" class="nav-link flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-100" data-tab="resources">
                    <i class="fas fa-book-open w-6 text-center text-gray-400"></i><span class="ml-3">Resources</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8">
            <!-- Dashboard Content -->
            <div id="dashboard" class="tab-content">
                <div>
                    <h2 class="text-3xl font-bold text-gray-700">Welcome Back, Official!</h2>
                    <p id="currentDate" class="text-teal-600 font-medium"></p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4"><div class="bg-green-100 p-3 rounded-full"><i class="fas fa-shield-alt text-2xl text-green-600"></i></div><div><h3 class="text-gray-500 font-semibold">Community Risk</h3><p id="riskLevel" class="text-2xl font-bold text-green-600">Low</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4"><div class="bg-blue-100 p-3 rounded-full"><i class="fas fa-tint text-2xl text-blue-600"></i></div><div><h3 class="text-gray-500 font-semibold">Water Quality</h3><p id="waterQualityStatus" class="text-2xl font-bold text-blue-600">Good</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4"><div class="bg-red-100 p-3 rounded-full"><i class="fas fa-triangle-exclamation text-2xl text-red-600"></i></div><div><h3 class="text-gray-500 font-semibold">Active Alerts</h3><p id="activeAlertsCount" class="text-2xl font-bold text-red-600">0</p></div></div>
                </div>
                <div class="grid lg:grid-cols-3 gap-6 mt-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                         <h3 class="font-semibold mb-4 text-lg">7-Day Health Trends</h3><canvas id="healthTrendsChart"></canvas>
                    </div>
                     <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="font-semibold text-lg mb-4">Community Pulse</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"><i class="fas fa-arrow-trend-up w-4 h-4 text-green-600"></i></div><span class="font-medium text-gray-700">Community Growth</span></div><span id="pulseGrowth" class="font-bold text-green-600">+12%</span></div>
                            <div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"><i class="fas fa-users w-4 h-4 text-blue-600"></i></div><span class="font-medium text-gray-700">Reports Today</span></div><span id="pulseReportsToday" class="font-bold text-blue-600">0</span></div>
                            <div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"><i class="fas fa-award w-4 h-4 text-purple-600"></i></div><span class="font-medium text-gray-700">Total Cases Logged</span></div><span id="pulseTotalCases" class="font-bold text-purple-600">0</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map View Content -->
            <div id="map" class="tab-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-700">Alert Map View</h2>
                <div id="mapContainer" class="w-full h-[600px] rounded-xl shadow-lg"></div>
            </div>

            <!-- Report Data Content -->
            <div id="report" class="tab-content hidden">
                 <h2 class="text-3xl font-bold mb-6 text-gray-700">Log New Data</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="font-semibold mb-4 text-lg text-indigo-700">Report Health Case</h3>
                        <form id="healthReportForm" class="space-y-4">
                            <input name="symptoms" type="text" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="Symptoms (e.g., Fever, Diarrhea)" required>
                            <input name="location" type="text" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="Location / Village" required>
                            <input name="peopleAffected" type="number" min="1" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="No. of People Affected" required>
                            <div class="flex space-x-4 pt-2">
                                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors">Submit Report</button>
                                <button type="button" id="resetHealthForm" class="w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors">Reset</button>
                            </div>
                        </form>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md">
                         <h3 class="font-semibold mb-4 text-lg text-teal-700">Submit Water Quality Data</h3>
                        <form id="waterReportForm" class="space-y-4">
                            <input name="phLevel" type="number" step="0.1" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" placeholder="pH Level" required>
                            <input name="turbidity" type="number" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" placeholder="Turbidity (NTU)" required>
                            <button type="submit" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 transition-colors mt-12">Submit Water Data</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Publish Alert Content -->
            <div id="publish" class="tab-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-700">Community Health Alerts</h2>
                <div class="bg-white p-6 rounded-xl shadow-md">
                     <h3 class="font-semibold mb-4 text-lg text-red-700">Create a New Public Alert</h3>
                     <form id="alertForm" class="space-y-4">
                        <input type="text" id="alertDisease" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" placeholder="Disease Name (e.g., Cholera)" required>
                        <input type="text" id="alertLocation" list="locations" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" placeholder="Affected Location (e.g., CIDCO)" required>
                        <datalist id="locations">
                            <option value="CIDCO">
                            <option value="Waluj">
                            <option value="Shahgunj">
                            <option value="Railway Station">
                        </datalist>
                        <input type="number" id="alertAffected" min="1" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" placeholder="Number of People Affected" required>
                        <textarea id="alertSymptoms" rows="3" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" placeholder="Key Symptoms" required></textarea>
                        <textarea id="alertPrecautions" rows="3" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" placeholder="Precautions to Take" required></textarea>
                        <button type="submit" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-paper-plane mr-2"></i>Publish Alert to Public App
                        </button>
                     </form>
                </div>
                 <div class="mt-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-700">Currently Active Alerts</h3>
                    <div id="publishedAlertsContainer" class="space-y-4">
                        <p class="text-gray-500 p-4 bg-white rounded-xl shadow-md">No alerts are currently published.</p>
                    </div>
                </div>
            </div>

            <!-- Resources Content -->
            <div id="resources" class="tab-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-700">Health Resources</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <a href="https://www.who.int" target="_blank" class="block bg-blue-600 p-6 rounded-xl shadow-md text-white hover:bg-blue-700 transition-colors">
                        <h3 class="font-bold text-lg">World Health Organization (WHO)</h3>
                        <p class="mt-2">Global information on diseases, health emergencies, and wellness.</p>
                    </a>
                     <a href="https://mohfw.gov.in/" target="_blank" class="block bg-green-600 p-6 rounded-xl shadow-md text-white hover:bg-green-700 transition-colors">
                        <h3 class="font-bold text-lg">Ministry of Health & Family Welfare</h3>
                        <p class="mt-2">Official health advisories and information for India.</p>
                    </a>
                </div>
            </div>
        </main>
    </div>
    
    <div id="toast" class="toast"></div>

    <!-- Firebase SDK and JS Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // --- IMPORTANT: PASTE YOUR FIREBASE CONFIGURATION HERE ---
        const firebaseConfig = {
  apiKey: "AIzaSyCyEK1SjgxF3BuOIYT7nTvY8RpuErrxS1o",
  authDomain: "rog-rakshak.firebaseapp.com",
  databaseURL: "https://rog-rakshak-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rog-rakshak",
  storageBucket: "rog-rakshak.firebasestorage.app",
  messagingSenderId: "131081764163",
  appId: "1:131081764163:web:1ad5b9008bf00ef024c3f6",
  measurementId: "G-3SEQH6TKFD"
};

        // ---------------------------------------------------------

        let db;
        const state = { 
            healthReports: [2, 3, 1, 4, 2, 5, 3], 
            waterQuality: { ph: 7.2, turbidity: 4 }, 
            publishedAlerts: [],
            stats: {
                reportsToday: 0,
                totalCasesLogged: 0,
                lastReportDate: null,
            }
        };

        if (firebaseConfig && firebaseConfig.projectId) {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                console.log("Firebase initialized successfully.");
            } catch (e) {
                console.error("Firebase initialization failed.", e);
                document.getElementById('firebase-config-warning').classList.remove('hidden');
            }
        } else {
            console.warn("Firebase configuration is missing.");
            document.getElementById('firebase-config-warning').classList.remove('hidden');
        }
        
        const navLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');
        const healthReportForm = document.getElementById('healthReportForm');
        const waterReportForm = document.getElementById('waterReportForm');
        const resetHealthFormBtn = document.getElementById('resetHealthForm');
        const alertForm = document.getElementById('alertForm');
        const publishedAlertsContainer = document.getElementById('publishedAlertsContainer');
        const toastEl = document.getElementById('toast');
        const riskLevelEl = document.getElementById('riskLevel');
        const waterQualityStatusEl = document.getElementById('waterQualityStatus');
        const activeAlertsCountEl = document.getElementById('activeAlertsCount');
        const currentDateEl = document.getElementById('currentDate');
        const pulseReportsTodayEl = document.getElementById('pulseReportsToday');
        const pulseTotalCasesEl = document.getElementById('pulseTotalCases');
        let healthChart;
        let map;
        let mapMarkersLayer = L.layerGroup();

        const locationCoordinates = { "CIDCO": [19.8725, 75.3817], "Waluj": [19.8153, 75.2415], "Shahgunj": [19.8858, 75.3225], "Railway Station": [19.8787, 75.3598] };

        const createRiskIcon = (level) => {
            let color;
            if (level === 'High') color = '#EF4444'; else if (level === 'Medium') color = '#F59E0B'; else color = '#10B981';
            const iconHtml = `<div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.5);"></div>`;
            return L.divIcon({ html: iconHtml, className: '', iconSize: [24, 24], iconAnchor: [12, 12] });
        };
        
        const initMap = () => {
            if (map) return;
            map = L.map('mapContainer').setView([19.8762, 75.3433], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '© OpenStreetMap' }).addTo(map);
            mapMarkersLayer.addTo(map);
        };
        
        const updateMapMarkers = () => {
            mapMarkersLayer.clearLayers();
            state.publishedAlerts.forEach(alert => {
                const locationKey = Object.keys(locationCoordinates).find(key => alert.location.toLowerCase().includes(key.toLowerCase()));
                if(locationKey){
                    const coords = locationCoordinates[locationKey];
                    const marker = L.marker(coords, { icon: createRiskIcon(alert.level) }).bindPopup(`<b>${alert.disease}</b><br>Location: ${alert.location}<br>Risk: ${alert.level}`);
                    mapMarkersLayer.addLayer(marker);
                }
            });
        };
        
        currentDateEl.textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        const publishDataToDB = async () => {
            if (!db) return;
            const waterIsGood = (state.waterQuality.ph >= 6.5 && state.waterQuality.ph <= 8.5 && state.waterQuality.turbidity < 5);
            const dataToPublish = {
                alerts: state.publishedAlerts,
                waterQualityStatus: waterIsGood ? 'Good' : 'Poor',
                weatherCondition: "Partly Cloudy, 30°C",
                communityHealth: riskLevelEl.textContent,
                communityPulse: {
                    reportsToday: state.stats.reportsToday,
                    totalCasesLogged: state.stats.totalCasesLogged,
                    growth: "+12%" // Static for now
                },
                lastUpdated: new Date().toISOString(),
            };
            try {
                await setDoc(doc(db, "rog-rakshak", "liveData"), dataToPublish);
                console.log('Published data to Firestore:', dataToPublish);
            } catch (error) {
                console.error("Error writing to Firestore: ", error);
                showToast("Error: Could not sync with database.");
            }
        };

        const renderPublishedAlerts = () => {
            publishedAlertsContainer.innerHTML = '';
            if (state.publishedAlerts.length === 0) {
                publishedAlertsContainer.innerHTML = '<p class="text-gray-500 p-4 bg-white rounded-xl shadow-md">No alerts are currently published.</p>';
            } else {
                state.publishedAlerts.forEach((alert, index) => {
                    const alertEl = document.createElement('div');
                    alertEl.className = 'bg-white p-4 rounded-xl shadow-md flex justify-between items-center';
                    alertEl.innerHTML = `<div><p class="font-bold">${alert.disease} - <span class="font-normal text-gray-600">${alert.location}</span></p><p class="text-sm text-gray-500">Affected: ${alert.affected} | Risk: <span class="font-semibold">${alert.level}</span></p></div><button data-index="${index}" class="remove-alert-btn text-red-500 hover:text-red-700 font-semibold px-3 py-1 rounded-lg hover:bg-red-50">Remove</button>`;
                    publishedAlertsContainer.appendChild(alertEl);
                });
            }
            activeAlertsCountEl.textContent = state.publishedAlerts.length;
            updateMapMarkers();
        };
        
        const createChart = () => {
            const ctx = document.getElementById('healthTrendsChart').getContext('2d');
            if (healthChart) healthChart.destroy();
            healthChart = new Chart(ctx, { type: 'line', data: { labels: ['6 days ago', '5', '4', '3', '2', 'Yesterday', 'Today'], datasets: [{ label: 'Reported Cases', data: state.healthReports, backgroundColor: 'rgba(79, 70, 229, 0.1)', borderColor: '#4f46e5', borderWidth: 3, tension: 0.4, fill: true, }] }, options: { scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } } });
        };

        const updateDashboard = () => {
            const recentCases = state.healthReports[state.healthReports.length - 1];
            const { ph, turbidity } = state.waterQuality;
            let waterIsGood = (ph >= 6.5 && ph <= 8.5 && turbidity < 5);
            waterQualityStatusEl.textContent = waterIsGood ? 'Good' : 'Poor';
            document.querySelector('#waterQualityStatus').parentElement.previousElementSibling.className = `p-3 rounded-full ${waterIsGood ? 'bg-blue-100' : 'bg-orange-100'}`;
            document.querySelector('#waterQualityStatus').previousElementSibling.className = `fas fa-tint text-2xl ${waterIsGood ? 'text-blue-600' : 'text-orange-600'}`;
            
            let risk = 'Low'; let riskColor = 'text-green-600'; let riskBg = 'bg-green-100'; let riskIcon = 'fa-shield-alt';
            if (recentCases > 5 || !waterIsGood) { risk = 'Medium'; riskColor = 'text-yellow-600'; riskBg = 'bg-yellow-100'; riskIcon = 'fa-exclamation-triangle'; }
            if (recentCases > 8 && !waterIsGood) { risk = 'High'; riskColor = 'text-red-600'; riskBg = 'bg-red-100'; riskIcon = 'fa-biohazard'; }
            riskLevelEl.textContent = risk;
            riskLevelEl.className = `text-2xl font-bold ${riskColor}`;
            riskLevelEl.parentElement.previousElementSibling.className = `p-3 rounded-full ${riskBg}`;
            riskLevelEl.parentElement.previousElementSibling.firstElementChild.className = `fas ${riskIcon} text-2xl ${riskColor}`;
            
            pulseReportsTodayEl.textContent = state.stats.reportsToday;
            pulseTotalCasesEl.textContent = state.stats.totalCasesLogged;
            
            createChart();
            publishDataToDB();
        };

        const loadInitialData = async () => {
            if (!db) {
                updateDashboard();
                renderPublishedAlerts();
                return;
            };

            const docRef = doc(db, "rog-rakshak", "liveData");
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    console.log("Loaded initial data from Firestore:", data);
                    state.publishedAlerts = data.alerts || [];
                    state.stats.totalCasesLogged = data.communityPulse?.totalCasesLogged || 0;
                    // Note: We don't load reportsToday to ensure it's session-based.
                } else {
                    console.log("No initial data found in Firestore.");
                }
            } catch (error) {
                console.error("Error loading initial data:", error);
            }
            updateDashboard();
            renderPublishedAlerts();
        };

        navLinks.forEach(link => link.addEventListener('click', e => { 
            e.preventDefault(); 
            navLinks.forEach(l => l.classList.remove('active')); 
            link.classList.add('active'); 
            tabContents.forEach(c => c.classList.toggle('hidden', c.id !== link.dataset.tab)); 
            if(link.dataset.tab === 'map') { initMap(); setTimeout(() => map.invalidateSize(), 10); }
        }));
        healthReportForm.addEventListener('submit', (e) => { 
            e.preventDefault(); 
            state.healthReports.shift(); 
            state.healthReports.push(parseInt(e.target.peopleAffected.value, 10)); 

            const today = new Date().toISOString().slice(0, 10);
            if (state.stats.lastReportDate !== today) {
                state.stats.reportsToday = 1;
                state.stats.lastReportDate = today;
            } else {
                state.stats.reportsToday++;
            }
            state.stats.totalCasesLogged++;

            updateDashboard(); 
            showToast('Health report submitted!'); 
        });
        resetHealthFormBtn.addEventListener('click', () => { healthReportform.reset(); showToast('Health form fields cleared.'); });
        waterReportForm.addEventListener('submit', (e) => { e.preventDefault(); state.waterQuality.ph = parseFloat(e.target.phLevel.value); state.waterQuality.turbidity = parseFloat(e.target.turbidity.value); updateDashboard(); e.target.reset(); showToast('Water data submitted!'); });
        alertForm.addEventListener('submit', (e) => { e.preventDefault(); const newAlert = { id: Date.now(), disease: e.target.alertDisease.value, location: e.target.alertLocation.value, affected: e.target.alertAffected.value, level: riskLevelEl.textContent, symptoms: e.target.alertSymptoms.value, precautions: e.target.alertPrecautions.value, }; state.publishedAlerts.push(newAlert); publishDataToDB(); renderPublishedAlerts(); alertForm.reset(); showToast('Alert published successfully!'); });
        publishedAlertsContainer.addEventListener('click', (e) => { if (e.target.classList.contains('remove-alert-btn')) { const index = e.target.dataset.index; state.publishedAlerts.splice(index, 1); publishDataToDB(); renderPublishedAlerts(); showToast('Alert removed.'); } });
        const showToast = (message) => { toastEl.textContent = message; toastEl.classList.add('show'); setTimeout(() => toastEl.classList.remove('show'), 3000); };
        
        loadInitialData();
    </script>
</body>
</html>

