<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROG-RAKSHAK (Public Alerts)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet Map Library -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f7f4; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        .toast {
            visibility: hidden; min-width: 250px; margin-left: -125px; background-color: #333; color: #fff; text-align: center;
            border-radius: 8px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; opacity: 0;
            transition: visibility 0s, opacity 0.5s linear;
        }
        .toast.show { visibility: visible; opacity: 1; }
        .main-nav-link { border-bottom: 3px solid transparent; }
        .main-nav-link.active { border-bottom-color: #4f46e5; color: #4f46e5; font-weight: 600; }
        #mapContainerPublic { height: 500px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white shadow-sm">
        <div class="max-w-5xl mx-auto py-4 px-6 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                 <div class="bg-teal-500 p-2 rounded-full">
                     <i class="fas fa-heart-pulse text-white"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-700" data-translate="title">ROG-RAKSHAK</h1>
                    <p class="text-sm text-gray-500" data-translate="subtitle">Public Health Information System</p>
                </div>
            </div>
            <div class="relative">
                <select id="languageSwitcher" class="block appearance-none w-full bg-gray-100 border border-gray-200 text-gray-700 py-2 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-gray-500">
                    <option value="en">English</option>
                    <option value="mr">मराठी</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                    <i class="fas fa-chevron-down text-xs"></i>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-6">
        <!-- Community Status Section -->
        <section id="status-section" class="mb-8">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                <div class="bg-white p-4 rounded-xl shadow-md flex items-center space-x-4"><div class="bg-yellow-100 p-3 rounded-full"><i class="fas fa-cloud-sun text-2xl text-yellow-600"></i></div><div><h3 class="text-gray-500 text-sm font-semibold" data-translate="weather">WEATHER</h3><p id="weatherStatus" class="text-lg font-bold">--</p></div></div>
                <div class="bg-white p-4 rounded-xl shadow-md flex items-center space-x-4"><div id="waterQualityIconContainer" class="bg-gray-100 p-3 rounded-full"><i id="waterQualityIcon" class="fas fa-tint text-2xl text-gray-600"></i></div><div><h3 class="text-gray-500 text-sm font-semibold" data-translate="water_quality">WATER QUALITY</h3><p id="waterQualityStatus" class="text-lg font-bold">--</p></div></div>
                <div class="bg-white p-4 rounded-xl shadow-md flex items-center space-x-4"><div id="communityHealthIconContainer" class="bg-gray-100 p-3 rounded-full"><i id="communityHealthIcon" class="fas fa-heartbeat text-2xl text-gray-600"></i></div><div><h3 class="text-gray-500 text-sm font-semibold" data-translate="health_risks">HEALTH RISKS</h3><p id="communityHealthStatus" class="text-lg font-bold">--</p></div></div>
            </div>
        </section>

        <!-- Main Content Tabs -->
        <div class="bg-white rounded-xl shadow-md p-2">
            <nav class="flex space-x-2" id="main-nav">
                <a href="#" class="main-nav-link active py-3 px-4 text-center flex-1" data-tab="alerts"><i class="fas fa-bullhorn mr-2"></i><span data-translate="tab_alerts">Alerts</span></a>
                <a href="#" class="main-nav-link py-3 px-4 text-center flex-1" data-tab="dashboard"><i class="fas fa-chart-line mr-2"></i><span data-translate="tab_dashboard">Dashboard</span></a>
                <a href="#" class="main-nav-link py-3 px-4 text-center flex-1" data-tab="map"><i class="fas fa-map-marked-alt mr-2"></i><span data-translate="tab_map">Map View</span></a>
            </nav>

            <div class="p-4">
                <!-- Alerts Tab Content -->
                <div id="alerts" class="main-tab-content">
                    <div id="alertsContainer" class="space-y-6">
                        <div id="loading-message" class="text-center p-8">
                            <i class="fas fa-spinner fa-spin text-3xl text-gray-400 mb-4"></i>
                            <h3 class="font-semibold text-lg" data-translate="connecting">Connecting to server...</h3>
                            <p class="text-gray-500" data-translate="fetching_data">Fetching the latest health data.</p>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Tab Content -->
                <div id="dashboard" class="main-tab-content hidden">
                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                             <h3 class="font-semibold mb-4 text-lg" data-translate="trends_title">7-Day Health Trends</h3>
                             <canvas id="publicHealthTrendsChart"></canvas>
                        </div>
                         <div>
                            <h3 class="font-semibold text-lg mb-4" data-translate="pulse_title">Community Pulse</h3>
                            <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                                <div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center"><i class="fas fa-arrow-trend-up w-4 h-4 text-green-600"></i></div><span class="font-medium text-gray-700" data-translate="pulse_growth">Community Growth</span></div><span id="pulseGrowth" class="font-bold text-green-600">--</span></div>
                                <div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center"><i class="fas fa-users w-4 h-4 text-blue-600"></i></div><span class="font-medium text-gray-700" data-translate="pulse_reports">Reports Today</span></div><span id="pulseReportsToday" class="font-bold text-blue-600">--</span></div>
                                <div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center"><i class="fas fa-award w-4 h-4 text-purple-600"></i></div><span class="font-medium text-gray-700" data-translate="pulse_cases">Total Cases Logged</span></div><span id="pulseTotalCases" class="font-bold text-purple-600">--</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Map View Tab Content -->
                <div id="map" class="main-tab-content hidden">
                     <div id="mapContainerPublic" class="w-full h-[500px] rounded-xl shadow-lg"></div>
                </div>
            </div>
        </div>

        <!-- Other Sections -->
        <section id="reporting-section" class="mt-12">
            <h2 class="text-2xl font-bold text-gray-700 mb-4" data-translate="report_symptoms_title">Help Your Community</h2>
            <div class="bg-white p-6 rounded-xl shadow-md text-center">
                <p class="text-gray-600 mb-4" data-translate="report_symptoms_desc">Feeling unwell? Anonymously report your symptoms to help health officials track trends.</p>
                <button id="reportSymptomsBtn" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors">
                    <i class="fas fa-user-shield mr-2"></i> <span data-translate="report_symptoms_btn">Report Symptoms Anonymously</span>
                </button>
            </div>
        </section>
        
        <section id="resources-section" class="mt-12">
            <h2 class="text-2xl font-bold text-gray-700 mb-4" data-translate="official_resources_title">Official Health Resources</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <a href="https://www.who.int" target="_blank" class="block bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"><h3 class="font-bold text-lg text-blue-800" data-translate="who_title">World Health Organization (WHO)</h3><p class="text-gray-600 mt-2" data-translate="who_desc">Global information on diseases, health emergencies, and wellness.</p></a>
                 <a href="https://mohfw.gov.in/" target="_blank" class="block bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"><h3 class="font-bold text-lg text-green-800" data-translate="mohfw_title">Ministry of Health & Family Welfare</h3><p class="text-gray-600 mt-2" data-translate="mohfw_desc">Official health advisories and information for India.</p></a>
            </div>
        </section>

        <section id="education-section" class="mt-12">
            <h2 class="text-2xl font-bold text-gray-700 mb-4" data-translate="local_practices_title">Local Health Practices</h2>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-md"><h3 class="font-bold text-lg text-green-800" data-translate="safe_water_title">Safe Water Practices</h3><p class="text-gray-600 mt-2" data-translate="safe_water_desc">Always boil drinking water for at least 1 minute. Store water in clean, covered containers.</p></div>
                <div class="bg-white p-6 rounded-xl shadow-md"><h3 class="font-bold text-lg text-blue-800" data-translate="hygiene_title">Hand Hygiene Tips</h3><p class="text-gray-600 mt-2" data-translate="hygiene_desc">Wash hands with soap for 20 seconds before eating and after using the toilet to prevent germ spread.</p></div>
             </div>
        </section>
    </main>

    <footer class="text-center py-6 mt-8">
        <p class="text-sm text-gray-500"><span data-translate="last_updated">Last updated</span>: <span id="lastUpdated">N/A</span></p>
    </footer>

    <!-- Symptom Modal -->
    <div id="symptomModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 animate-fade-in">
            <h3 class="font-bold text-xl mb-4" data-translate="modal_title">Report Anonymous Symptoms</h3>
            <p class="text-gray-600 text-sm mb-6" data-translate="modal_desc">Select any symptoms you are experiencing. This data is fully anonymous and helps us identify potential outbreaks sooner.</p>
            <div id="symptom-checkboxes" class="grid grid-cols-2 gap-4 mb-6"></div>
            <div class="flex justify-end space-x-4">
                <button id="closeModalBtn" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300" data-translate="modal_cancel">Cancel</button>
                <button id="submitSymptomsBtn" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700" data-translate="modal_submit">Submit Anonymously</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

               const firebaseConfig = {
  apiKey: "AIzaSyCyEK1SjgxF3BuOIYT7nTvY8RpuErrxS1o",
  authDomain: "rog-rakshak.firebaseapp.com",
  databaseURL: "https://rog-rakshak-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rog-rakshak",
  storageBucket: "rog-rakshak.firebasestorage.app",
  messagingSenderId: "131081764163",
  appId: "1:131081764163:web:1ad5b9008bf00ef024c3f6",
  measurementId: "G-3SEQH6TKFD"
};



        const translations = {
            en: {
                title: "ROG-RAKSHAK", subtitle: "Public Health Information System", weather: "WEATHER", water_quality: "WATER QUALITY", health_risks: "HEALTH RISKS", health_alerts_title: "Community Health Alerts", connecting: "Connecting to server...", fetching_data: "Fetching the latest health data.", last_updated: "Last updated", all_clear_title: "All Clear!", all_clear_desc: "There are no active health alerts.", symptoms: "Symptoms", precautions: "Precautions", location: "Location", affected: "Affected", risk: "RISK", issued_on: "Issued on", alert_copied: "Alert details copied to clipboard!", report_symptoms_title: "Help Your Community", report_symptoms_desc: "Feeling unwell? Anonymously report your symptoms to help health officials track trends.", report_symptoms_btn: "Report Symptoms Anonymously", modal_title: "Report Anonymous Symptoms", modal_desc: "Select any symptoms you are experiencing. This data is fully anonymous and helps us identify potential outbreaks sooner.", modal_cancel: "Cancel", modal_submit: "Submit Anonymously", symptom_fever: "Fever", symptom_cough: "Cough", symptom_diarrhea: "Diarrhea", symptom_headache: "Headache", symptom_fatigue: "Fatigue", symptom_sore_throat: "Sore Throat", report_submitted: "Report submitted. Thank you!",
                official_resources_title: "Official Health Resources", who_title: "World Health Organization (WHO)", who_desc: "Global information on diseases, health emergencies, and wellness.", mohfw_title: "Ministry of Health & Family Welfare", mohfw_desc: "Official health advisories and information for India.", local_practices_title: "Local Health Practices", safe_water_title: "Safe Water Practices", safe_water_desc: "Always boil drinking water for at least 1 minute. Store water in clean, covered containers.", hygiene_title: "Hand Hygiene Tips", hygiene_desc: "Wash hands with soap for 20 seconds before eating and after using the toilet to prevent germ spread.",
                tab_alerts: "Alerts", tab_dashboard: "Dashboard", tab_map: "Map View", trends_title: "7-Day Health Trends", pulse_title: "Community Pulse", pulse_growth: "Community Growth", pulse_reports: "Reports Today", pulse_cases: "Total Cases Logged"
            },
            mr: {
                title: "रोग-रक्षक", subtitle: "सार्वजनिक आरोग्य माहिती प्रणाली", weather: "हवामान", water_quality: "पाण्याची गुणवत्ता", health_risks: "आरोग्य धोके", health_alerts_title: "समुदाय आरोग्य सूचना", connecting: "सर्व्हरशी कनेक्ट करत आहे...", fetching_data: "नवीनतम आरोग्य डेटा आणत आहे.", last_updated: "शेवटचे अपडेट", all_clear_title: "सर्व ठीक आहे!", all_clear_desc: "सध्या कोणतीही सक्रिय आरोग्य सूचना नाही.", symptoms: "लक्षणे", precautions: "काळजी", location: "स्थान", affected: "बाधित", risk: "धोका", issued_on: "जारी केल्याची तारीख", alert_copied: "सूचनेचा तपशील क्लिपबोर्डवर कॉपी केला!", report_symptoms_title: "तुमच्या समुदायाला मदत करा", report_symptoms_desc: "आजारी वाटत आहे? आरोग्य अधिकाऱ्यांना ट्रेंडचा मागोवा घेण्यासाठी तुमची लक्षणे अज्ञातपणे कळवा.", report_symptoms_btn: "अज्ञातपणे लक्षणे कळवा", modal_title: "अज्ञात लक्षणे कळवा", modal_desc: "तुम्ही अनुभवत असलेली कोणतीही लक्षणे निवडा. हा डेटा पूर्णपणे अज्ञात आहे आणि संभाव्य उद्रेक लवकर ओळखण्यात आम्हाला मदत करतो.", modal_cancel: "रद्द करा", modal_submit: "अज्ञातपणे सबमिट करा", symptom_fever: "ताप", symptom_cough: "खोकला", symptom_diarrhea: "अतिसार", symptom_headache: "डोकेदुखी", symptom_fatigue: "थकवा", symptom_sore_throat: "घसा खवखवणे", report_submitted: "अहवाल सबमिट केला. धन्यवाद!",
                official_resources_title: "अधिकृत आरोग्य संसाधने", who_title: "जागतिक आरोग्य संघटना (WHO)", who_desc: "रोग, आरोग्य आणीबाणी आणि निरोगीपणाबद्दल जागतिक माहिती.", mohfw_title: "आरोग्य व कुटुंब कल्याण मंत्रालय", mohfw_desc: "भारतासाठी अधिकृत आरोग्य सल्ला आणि माहिती.", local_practices_title: "स्थानिक आरोग्य पद्धती", safe_water_title: "सुरक्षित पाणी पद्धती", safe_water_desc: "पिण्याचे पाणी नेहमी किमान १ मिनिट उकळा. पाणी स्वच्छ, झाकलेल्या भांड्यात साठवा.", hygiene_title: "हात स्वच्छतेच्या टिप्स", hygiene_desc: "जेवण्यापूर्वी आणि शौचालयाचा वापर केल्यानंतर २० सेकंद साबणाने हात धुवा.",
                tab_alerts: "सूचना", tab_dashboard: "डॅशबोर्ड", tab_map: "नकाशा दृश्य", trends_title: "७-दिवसीय आरोग्य ट्रेंड", pulse_title: "समुदाय पल्स", pulse_growth: "समुदाय वाढ", pulse_reports: "आजचे अहवाल", pulse_cases: "एकूण नोंदवलेले प्रकरणे"
            }
        };

        let currentLanguage = 'en';
        let publicHealthChart;
        let map;
        let mapMarkersLayer = L.layerGroup();

        const locationCoordinates = { "CIDCO": [19.8725, 75.3817], "Waluj": [19.8153, 75.2415], "Shahgunj": [19.8858, 75.3225], "Railway Station": [19.8787, 75.3598] };

        const createRiskIcon = (level) => {
            let color;
            if (level === 'High') color = '#EF4444'; else if (level === 'Medium') color = '#F59E0B'; else color = '#10B981';
            const iconHtml = `<div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.5);"></div>`;
            return L.divIcon({ html: iconHtml, className: '', iconSize: [24, 24], iconAnchor: [12, 12] });
        };

        const initMap = () => {
            if (map) return;
            map = L.map('mapContainerPublic').setView([19.8762, 75.3433], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '© OpenStreetMap' }).addTo(map);
            mapMarkersLayer.addTo(map);
        };

        const updateMapMarkers = (alerts) => {
            if (!map) return;
            mapMarkersLayer.clearLayers();
            alerts.forEach(alert => {
                const locationKey = Object.keys(locationCoordinates).find(key => alert.location.toLowerCase().includes(key.toLowerCase()));
                if(locationKey){
                    const coords = locationCoordinates[locationKey];
                    const marker = L.marker(coords, { icon: createRiskIcon(alert.level) }).bindPopup(`<b>${alert.disease}</b><br>Location: ${alert.location}<br>Risk: ${alert.level}`);
                    mapMarkersLayer.addLayer(marker);
                }
            });
        };
        
        const createPublicChart = () => {
            const ctx = document.getElementById('publicHealthTrendsChart').getContext('2d');
            if (publicHealthChart) publicHealthChart.destroy();
            const sampleData = { labels: ['6 days ago', '5', '4', '3', '2', 'Yesterday', 'Today'], cases: [2, 3, 1, 4, 2, 5, 3]};
            publicHealthChart = new Chart(ctx, { type: 'line', data: { labels: sampleData.labels, datasets: [{ label: 'Reported Cases', data: sampleData.cases, backgroundColor: 'rgba(79, 70, 229, 0.1)', borderColor: '#4f46e5', borderWidth: 3, tension: 0.4, fill: true, }] }, options: { scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } } });
        };


        const setLanguage = (lang) => {
            currentLanguage = lang;
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                if (translations[lang][key]) el.textContent = translations[lang][key];
            });
        };

        const languageSwitcher = document.getElementById('languageSwitcher');
        languageSwitcher.addEventListener('change', (e) => setLanguage(e.target.value));

        let db;
        if (firebaseConfig && firebaseConfig.projectId) {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
            } catch (e) { document.getElementById('loading-message').innerHTML = '<i class="fas fa-exclamation-triangle text-3xl text-red-500 mb-4"></i><h3 class="font-semibold text-lg">Configuration Error</h3><p class="text-gray-500">Could not connect to the database.</p>'; }
        } else { document.getElementById('loading-message').innerHTML = '<i class="fas fa-exclamation-triangle text-3xl text-red-500 mb-4"></i><h3 class="font-semibold text-lg">Not Configured</h3><p class="text-gray-500">The application is missing database credentials.</p>'; }
        
        const renderPageData = (data, isFromCache = false) => {
            setLanguage(currentLanguage); 
            const lastUpdatedEl = document.getElementById('lastUpdated');
            if (!data) {
                document.getElementById('alertsContainer').innerHTML = `<div class="text-center p-8"><i class="fas fa-check-circle text-4xl text-green-500 mb-4"></i><h3 class="font-semibold text-lg" data-translate="all_clear_title">All Clear!</h3><p class="text-gray-500" data-translate="all_clear_desc">There are no active health alerts.</p></div>`;
                setLanguage(currentLanguage);
                return;
            }

            // Update status cards
            document.getElementById('weatherStatus').textContent = data.weatherCondition || '--';
            const waterStatus = data.waterQualityStatus || 'N/A';
            document.getElementById('waterQualityStatus').textContent = waterStatus;
            document.getElementById('waterQualityIcon').className = `fas fa-tint text-2xl ${waterStatus === 'Good' ? 'text-blue-600' : 'text-orange-600'}`;
            document.getElementById('waterQualityIconContainer').className = `p-3 rounded-full ${waterStatus === 'Good' ? 'bg-blue-100' : 'bg-orange-100'}`;
            const healthStatus = data.communityHealth || 'N/A';
            document.getElementById('communityHealthStatus').textContent = healthStatus;
            if (healthStatus === 'Low') { document.getElementById('communityHealthIcon').className = 'fas fa-shield-alt text-2xl text-green-600'; document.getElementById('communityHealthIconContainer').className = 'p-3 rounded-full bg-green-100'; } 
            else if (healthStatus === 'Medium') { document.getElementById('communityHealthIcon').className = 'fas fa-exclamation-triangle text-2xl text-yellow-600'; document.getElementById('communityHealthIconContainer').className = 'p-3 rounded-full bg-yellow-100'; } 
            else { document.getElementById('communityHealthIcon').className = 'fas fa-biohazard text-2xl text-red-600'; document.getElementById('communityHealthIconContainer').className = 'p-3 rounded-full bg-red-100'; }
            lastUpdatedEl.textContent = new Date(data.lastUpdated).toLocaleString() + (isFromCache ? " (cached)" : "");
            
            // Update Community Pulse
            if (data.communityPulse) {
                document.getElementById('pulseGrowth').textContent = data.communityPulse.growth || '--';
                document.getElementById('pulseReportsToday').textContent = data.communityPulse.reportsToday || 0;
                document.getElementById('pulseTotalCases').textContent = data.communityPulse.totalCasesLogged || 0;
            }

            // Update Alerts
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';
            if (!data.alerts || data.alerts.length === 0) {
                alertsContainer.innerHTML = `<div class="text-center p-8"><i class="fas fa-check-circle text-4xl text-green-500 mb-4"></i><h3 class="font-semibold text-lg" data-translate="all_clear_title">All Clear!</h3><p class="text-gray-500" data-translate="all_clear_desc">There are no active health alerts.</p></div>`;
            } else {
                data.alerts.forEach(alert => {
                    const alertCard = document.createElement('div');
                    let riskColor = 'border-red-500', riskIconColor = 'text-red-500';
                    if (alert.level === 'Medium') { riskColor = 'border-yellow-500'; riskIconColor = 'text-yellow-500';}
                    if (alert.level === 'Low') { riskColor = 'border-green-500'; riskIconColor = 'text-green-500';}
                    const alertDataString = JSON.stringify(alert);
                    alertCard.className = `bg-white p-6 rounded-xl shadow-md border-l-4 ${riskColor} animate-fade-in`;
                    alertCard.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex items-center space-x-4"><i class="fas fa-triangle-exclamation text-2xl ${riskIconColor}"></i><div><h3 class="text-xl font-bold text-gray-800">${alert.disease}</h3><p class="text-sm text-gray-500"><span data-translate="location">Location</span>: ${alert.location} | <span data-translate="affected">Affected</span>: ${alert.affected}</p></div></div>
                            <div class="text-sm font-semibold px-3 py-1 rounded-full ${riskIconColor} ${riskColor.replace('border-', 'bg-').replace('500', '100')}">${alert.level} <span data-translate="risk">RISK</span></div>
                        </div>
                        <div class="mt-4 pt-4 border-t text-gray-600 space-y-3"><p><strong><span data-translate="symptoms">Symptoms</span>:</strong> ${alert.symptoms}</p><p><strong><span data-translate="precautions">Precautions</span>:</strong> ${alert.precautions}</p></div>
                        <div class="mt-4 pt-4 border-t flex justify-between items-center text-sm text-gray-500"><span><span data-translate="issued_on">Issued on</span>: ${new Date(alert.id).toLocaleString()}</span><button class="share-btn text-gray-500 hover:text-indigo-600 transition-colors" data-alert='${alertDataString}'><i class="fas fa-share-alt mr-1"></i> Share</button></div>`;
                    alertsContainer.appendChild(alertCard);
                });
                updateMapMarkers(data.alerts);
            }
            setLanguage(currentLanguage);
        };

        const toastEl = document.getElementById('toast');
        const showToast = (messageKey) => { toastEl.textContent = translations[currentLanguage][messageKey]; toastEl.classList.add('show'); setTimeout(() => toastEl.classList.remove('show'), 3000); };
        
        const cachedData = localStorage.getItem('rog-rakshak-data');
        if (cachedData) { renderPageData(JSON.parse(cachedData), true); }

        if (db) {
            onSnapshot(doc(db, "rog-rakshak", "liveData"), (doc) => {
                const liveData = doc.data();
                if(liveData) localStorage.setItem('rog-rakshak-data', JSON.stringify(liveData));
                renderPageData(liveData, false);
            }, (error) => { console.error("Error listening to database:", error); if(!cachedData){ document.getElementById('alertsContainer').innerHTML = `<div class="text-center p-8"><i class="fas fa-exclamation-triangle text-3xl text-red-500 mb-4"></i><h3 class="font-semibold text-lg">Connection Error</h3><p class="text-gray-500">Could not retrieve live data.</p></div>`; }});
        }
        
        document.getElementById('alertsContainer').addEventListener('click', (e) => {
            const shareButton = e.target.closest('.share-btn');
            if (shareButton) {
                const alertData = JSON.parse(shareButton.dataset.alert);
                const textToCopy = `**ROG-RAKSHAK Health Alert**\nDisease: ${alertData.disease}\nLocation: ${alertData.location}\nRisk Level: ${alertData.level}\nSymptoms: ${alertData.symptoms}\nPrecautions: ${alertData.precautions}`;
                navigator.clipboard.writeText(textToCopy).then(() => showToast('alert_copied'));
            }
        });
        
        const reportSymptomsBtn = document.getElementById('reportSymptomsBtn');
        const symptomModal = document.getElementById('symptomModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const submitSymptomsBtn = document.getElementById('submitSymptomsBtn');
        const symptomCheckboxesContainer = document.getElementById('symptom-checkboxes');
        
        const symptoms = ['fever', 'cough', 'diarrhea', 'headache', 'fatigue', 'sore_throat'];
        
        const createSymptomCheckboxes = () => {
            symptomCheckboxesContainer.innerHTML = '';
            symptoms.forEach(symptom => {
                const label = document.createElement('label');
                label.className = "flex items-center space-x-2 text-gray-700 cursor-pointer";
                label.innerHTML = `<input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"><span data-translate="symptom_${symptom}">${translations.en[`symptom_${symptom}`]}</span>`;
                symptomCheckboxesContainer.appendChild(label);
            });
        };

        reportSymptomsBtn.addEventListener('click', () => { createSymptomCheckboxes(); setLanguage(currentLanguage); symptomModal.classList.remove('hidden'); symptomModal.classList.add('flex'); });
        const hideModal = () => { symptomModal.classList.add('hidden'); symptomModal.classList.remove('flex'); }
        closeModalBtn.addEventListener('click', hideModal);
        submitSymptomsBtn.addEventListener('click', () => { hideModal(); showToast('report_submitted'); });

        const navLinks = document.querySelectorAll('.main-nav-link');
        const tabContents = document.querySelectorAll('.main-tab-content');
        navLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                const tabId = link.dataset.tab;
                tabContents.forEach(c => c.classList.toggle('hidden', c.id !== tabId));
                if(tabId === 'map') {
                    initMap();
                    setTimeout(() => map.invalidateSize(), 10);
                } else if(tabId === 'dashboard'){
                    createPublicChart();
                }
            });
        });
    </script>
</body>
</html>

